datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum StatusOrder {
  Menunggu_Konfirmasi
  Diproses
  Menunggu_Kurir
  Dibatalkan_Pembeli
  Dibatalkan_Penjual
  Bermasalah
  Selesai
}

enum Jabatan {
  admin
  apoteker
  karyawan
  kasir
  pemilik
}

model User {
  id                BigInt    @id @default(autoincrement())
  name              String    @db.VarChar(255)
  email             String    @unique @db.VarChar(255)
  email_verified_at DateTime?
  password          String    @db.VarChar(255)
  remember_token    String?   @db.VarChar(100)
  jabatan           Jabatan
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  pengirimans       Pengiriman[]
}

model Pelanggan {
  id             BigInt   @id @default(autoincrement())
  nama_pelanggan String   @db.VarChar(255)
  email          String   @unique @db.VarChar(255)
  katakunci      String   @db.VarChar(255)
  no_telp        String?  @db.VarChar(25)
  alamat1        String?  @db.VarChar(255)
  kota1          String?  @db.VarChar(100)
  propinsi1      String?  @db.VarChar(100)
  kodepos1       String?  @db.VarChar(10)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  penjualans Penjualan[]
  keranjangs Keranjang[]
}

model Obat {
  id             BigInt   @id @default(autoincrement())
  nama_obat      String   @unique @db.VarChar(255)
  id_jenis_obat  BigInt
  harga_jual     Float
  stok           Int
  foto1          String?  @db.VarChar(255)
  deskripsi_obat String?  @db.Text
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  jenis_obat       JenisObat         @relation(fields: [id_jenis_obat], references: [id])
  detail_penjulans DetailPenjualan[]
  keranjangs       Keranjang[]
  detail_pembelians DetailPembelian[]
}

model JenisObat {
  id              BigInt   @id @default(autoincrement())
  jenis           String   @unique @db.VarChar(255)
  deskripsi_jenis String?  @db.Text
  image_url       String?  @db.VarChar(255)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  obats Obat[]
}

model Penjualan {
  id              BigInt      @id @default(autoincrement())
  id_metode_bayar BigInt
  tgl_penjualan   DateTime
  ongkos_kirim    Float
  biaya_app       Float
  total_bayar     Float
  status_order    StatusOrder
  id_jenis_kirim  BigInt
  id_pelanggan    BigInt
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt

  metode_bayar     MetodeBayar      @relation(fields: [id_metode_bayar], references: [id])
  jenis_pengiriman JenisPengiriman  @relation(fields: [id_jenis_kirim], references: [id])
  pelanggan        Pelanggan        @relation(fields: [id_pelanggan], references: [id])
  details          DetailPenjualan[]
  pengirimans      Pengiriman[]
}

model DetailPenjualan {
  id           BigInt   @id @default(autoincrement())
  id_penjualan BigInt
  id_obat      BigInt
  jumlah_beli  Int
  harga_beli   Float
  subtotal     Float
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  penjualan Penjualan @relation(fields: [id_penjualan], references: [id])
  obat      Obat      @relation(fields: [id_obat], references: [id])
}

model MetodeBayar {
  id                BigInt   @id @default(autoincrement())
  metode_pembayaran String   @unique @db.VarChar(255)
  tempat_bayar      String   @db.VarChar(100)
  no_rekening       String   @db.VarChar(25)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  penjualans Penjualan[]
}

model JenisPengiriman {
  id             BigInt   @id @default(autoincrement())
  jenis_kirim    String   @unique @db.VarChar(255)
  nama_ekspedisi String   @db.VarChar(100)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  penjualans Penjualan[]
}

model Pengiriman {
  id             BigInt   @id @default(autoincrement())
  id_penjualan   BigInt
  id_user        BigInt
  tgl_pengiriman DateTime
  keterangan     String?  @db.Text
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  penjualan Penjualan @relation(fields: [id_penjualan], references: [id])
  user      User      @relation(fields: [id_user], references: [id])
}

model Keranjang {
  id            BigInt   @id @default(autoincrement())
  id_pelanggan  BigInt
  id_obat       BigInt
  jumlah_beli   Int
  harga_beli    Float
  subtotal      Float
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  pelanggan Pelanggan @relation(fields: [id_pelanggan], references: [id])
  obat      Obat      @relation(fields: [id_obat], references: [id])
}

model Pembelian {
  id             BigInt   @id @default(autoincrement())
  nonota         String   @db.VarChar(25)
  tgl_pembelian  DateTime @db.Date
  total_bayar    Float
  id_distributor BigInt
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  distributor Distributor       @relation(fields: [id_distributor], references: [id])
  details     DetailPembelian[]
}

model DetailPembelian {
  id           BigInt   @id @default(autoincrement())
  id_pembelian BigInt
  id_obat      BigInt
  jumlah_beli  Int
  harga_beli   Float
  subtotal     Float
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  pembelian Pembelian @relation(fields: [id_pembelian], references: [id])
  obat      Obat      @relation(fields: [id_obat], references: [id])
}

model Distributor {
  id               BigInt   @id @default(autoincrement())
  nama_distributor String   @unique @db.VarChar(255)
  telepon          String   @db.VarChar(25)
  alamat           String   @db.Text
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  pembelians Pembelian[]
}
